//Entradas
//#define CanalCamara
//#define ObsAdel
//#define ObsAtr
//#define ObsDer
//#define ObsIzq

//Salidas
#define MotD1  22
#define MotD2  23
#define MotI1  24
#define MotI2  25

// varaibles globales
int obs;                    //Obstaculos
int objP;                   //Posición de la pelota
boolean limC = false;       //Detección de límite de cancha
boolean Nav = false;        //Bandera de Navegacion

void setup() {
  // put your setup code here, to run once:
  //  Entradas
  //Salidas
  pinMode(MotD1,OUTPUT);
  pinMode(MotD2,OUTPUT);
  pinMode(MotI1,OUTPUT);
  pinMode(MotI2,OUTPUT);
}

void loop() {
  // put your main code here, to run repeatedly:
  
  //Modo Búsqueda
  Busqueda:
    Nav = false;
    goto lecSens;
    if(objP == 3){   //si no se detectan pelotas
      goto giroDer;        //girar derecha
      goto lecSens;        //leer sensores
    }
    else{
      goto detener;
      Nav = true;
      goto Navegacion;      //Modo Navegacion
    }
    

  //Módo navegación
  Navegacion:
    if(objP == 1){   //Pelota a la derecha
      goto giroDer;        //girar derecha
      goto lecSens;        //leer sensores     
    }
    if(objP == 2){   //Pelota a la izquierda
      goto giroIzq;        //girar izquierda
      goto lecSens;        //leer sensores 
    }
    if(objP == 0){    //Pelota centrada
      goto lecSens;         //leer sensores
      goto adelante;        //Avanzar hacia adelante
    }

  //Modo Obstáculos
  Obstaculos:
    goto detener;
    delay(250);
    if(obs == 1){         //Obstáculo a la derecha
      goto giroIzq;       //girar izquierda
      goto lecSens;       //leer sensores
      return;
    }
    if(obs == 2){         //Obstáculo a la izquierda
      goto giroIzq;       //girar derecha
      goto lecSens;       //leer sensores
      return;
    }
    if(obs == 3){         //Obstáculo al frente
      goto giroDer;       //girar derecha
      goto lecSens;       //leer sensores
      return;
    }
    if(obs == 4){         //Obstáculo a la derecha
      goto giroDer;       //girar derecha
      goto lecSens;       //leer sensores
      return;
    }
    if(limC){             //Detección del límite de cancha
      goto atras;         //Ir hacia atras
      delay(1000);
      goto giroIzq;       //Girar izquierda
      delay(1000);
      goto lecSens;       //leer sensores
      return;
    } 

  lecSens:
    if( Nav && (limC || obs == 1 || obs == 2 || obs ==3)){          //Si se encuentra un obstáculo a la derecha, izquierda o enfrente, o se determina el límite de cancha mientras navega
      goto Obstaculos;
    }
    if( !Nav && (limC || obs != 0)){                                //Si no se encuentra navegando pero detecta límite de cancha
      goto Obstaculos;
    }
    if(objP == 3){                                                  //Si no se detectan pelotas
      goto Busqueda;
    }
    return;

//Estados de movimiento 
  giroDer:
    digitalWrite(MotI1,HIGH);
    digitalWrite(MotI2,LOW);
    digitalWrite(MotD1,LOW);
    digitalWrite(MotD2,HIGH);
    return;
  
  giroIzq:
    digitalWrite(MotI1,LOW);
    digitalWrite(MotI2,HIGH); 
    digitalWrite(MotD1,HIGH);   
    digitalWrite(MotD2,LOW);
    
    return;
    
  adelante:
    digitalWrite(MotI1,HIGH);
    digitalWrite(MotI2,LOW); 
    digitalWrite(MotD1,HIGH);   
    digitalWrite(MotD2,LOW);
    return;
    
  atras:
    digitalWrite(MotI1,LOW);
    digitalWrite(MotI2,HIGH); 
    digitalWrite(MotD1,LOW);   
    digitalWrite(MotD2,HIGH);
    return;
    
  detener:
    digitalWrite(MotI1,LOW);
    digitalWrite(MotI2,LOW); 
    digitalWrite(MotD1,LOW);   
    digitalWrite(MotD2,LOW);
    return;
    

}
